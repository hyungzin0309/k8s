
> Kubernetes 클러스터에 여러 마스터 노드가 있는 경우, 각각의 마스터 노드 내부에 존재하는 주요 구성 요소들(예: API 서버, etcd, 스케줄러 등)은 고가용성을 위해 특별히 설계된 방식으로 작동한다.

1. **API 서버 (kube-apiserver)**
<br>API 서버는 Kubernetes API의 전면에 있으며, 모든 내부 및 외부 요청의 진입점이다. 여러 마스터 노드에 API 서버의 인스턴스를 분산시킴으로써, 하나의 API 서버에 장애가 발생해도 다른 인스턴스가 요청을 처리할 수 있다. API 서버 인스턴스 앞에는 일반적으로 로드 밸런서가 배치되어 있어, 들어오는 요청을 여러 API 서버 인스턴스로 분산시킨다.


2. **etcd**
<br>etcd 클러스터는 시작 시 모든 노드가 후보자(Candidate) 상태가 되고, 그 중 하나의 etcd 를 리더(Leader)로 선출한다. 리더가 선출되면, 그 리더는 클러스터의 데이터 변경 작업(쓰기 작업)을 관리한다. 쓰기 요청에 대한 작업은 모두 리더 etcd 에 의해 이뤄지며, 쓰기 이후 저장된 데이터는 나머지 팔로워 etcd 에 공유되어 복제된다. 리더 etcd 에 문제가 생겨 사용할 수 없게 된 경우 다른 etcd 중 하나를 리더로 선출한다.<br><br>
etcd 를 HA 모드로 사용하는 경우, 과반수 노드의 승인에 따라 쓰기작업이 이뤄지는데, 만약 마스터 노드가 두 개인 경우, 하나의 노드만 불능상태가 되어도 과반수를 충족하지 못해 쓰기작업이 아예 불가능해지므로, 보통 세 개 이상의 노드를 사용하는 것이 권장되며, 홀수로 구성되는것이 더욱 권장된다. 


3. **스케줄러 (kube-scheduler)**
스케줄러는 새로 생성된 파드를 사용 가능한 노드에 할당하는 역할을 한다. 고가용성 환경에서는 여러 마스터 노드에 스케줄러 인스턴스가 실행될 수 있지만, 리더 선출(Leader Election) 메커니즘을 통해 한 시점에 하나의 스케줄러 인스턴스만이 활성 상태가 되어 파드를 스케줄링한다. 나머지 스케줄러 인스턴스는 대기 상태에 있으며, 활성 스케줄러에 장애가 발생하면 자동으로 새로운 스케줄러가 리더로 선출된다.


4. **컨트롤러 매니저 (kube-controller-manager)**
컨트롤러 매니저는 다양한 컨트롤러를 실행하여 Kubernetes 클러스터의 상태를 원하는 상태로 유지한다. 이 컴포넌트 역시 리더 선출 메커니즘을 사용하여 여러 인스턴스 중 하나만이 활성 상태에서 작동하고, 나머지는 스탠바이 모드로 대기한다.